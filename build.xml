<?xml version="1.0"?>

<project name="argoprint" default="run" basedir=".">

  <!-- =================================================================== -->
  <!-- Initialization target                                               -->
  <!-- =================================================================== -->

 <target name="init">

    <tstamp/>

    <property name="argo.root" value="../argouml"/>
    <property name="argo.build.dir" value="${argo.root}/build"/>
    <property name="argo.tools.dir" value="${argo.root}/tools"/>

    <property name="ant.xml-libs" value="${ANT_HOME}/lib/jaxp.jar:${ANT_HOME}/lib/parser.jar"/>

    <property name="debug" value="off"/>
    <property name="optimize" value="on"/>
    <property name="deprecation" value="off"/>

    <property name="module.build.dest" value="build"/>

  </target>

  <!-- =================================================================== -->
  <!-- Compiles the source directory                                       -->
  <!-- =================================================================== -->

  <target name="compile" depends="init"> 

    <echo message="Compiling the sources"/>

    <!-- create directories -->
    <mkdir dir="${module.build.dest}"/>
    <mkdir dir="${module.build.dest}/classes"/>

    <javac srcdir="src"
           destdir="${module.build.dest}/classes"
           excludes="*.txt,*.bat,*.xml,*.sh"
           debug="${debug}"
           deprecation="${deprecation}"
           optimize="${optimize}">
        <classpath>
            <fileset dir="${argo.build.dir}">
                <include name="argouml.jar" />
                <include name="nsuml.jar" />
                <include name="ocl-argo.jar" />
                <include name="antlrall.jar" />
                <include name="log4j.jar" />
                <include name="gef.jar" />
            </fileset>
        </classpath>
     </javac>
  </target>


  <!-- =================================================================== -->
  <!-- Creates the class package                                           -->
  <!-- =================================================================== -->
  <target name="package" depends="compile">
    <copy file="src/org/manifest.mf"
          tofile="${module.build.dest}/classes/org/manifest.mf"
	  filtering="on"
	  overwrite="on"/>
    <jar jarfile="${module.build.dest}/argoprint.jar"
         basedir="${module.build.dest}/classes"
         includes="org/**"
         excludes="*.txt,*.bat,*.xml,*.sh,manifest.mf"
	 manifest="${module.build.dest}/classes/org/manifest.mf"/>
  </target>

  <!-- =================================================================== -->
  <!-- Move the jar file into the extension directory.                     -->
  <!-- =================================================================== -->
  <target name="install" depends="package">
    <copy todir="${argo.build.dir}/ext">
      <fileset dir="${module.build.dest}" includes="argoprint.jar"/>
    </copy>
  </target>

  <!-- =================================================================== -->
  <!-- Run checkstyle with the ArgoUML settings.                           -->
  <!-- =================================================================== -->
  <target name="checkstyle" depends="init"
          description="Run checkstyle on all source.">
    <java classname="com.puppycrawl.tools.checkstyle.Main" failonerror="false" fork="true" maxmemory="32M">
      <sysproperty key="checkstyle.header.file" value="tools/checkstyle/java.header"/>
      <classpath>
        <fileset dir="${argo.tools.dir}/checkstyle-3.0">
	  <include name="*.jar"/>
	</fileset>
        <pathelement location="${argo.tools.dir}/ant-1.4.1/lib/xerces-1.2.3.jar"/>
      </classpath>
      <arg value="-c"/>
      <arg value="${argo.tools.dir}/checkstyle/checkstyle_argouml.xml"/>
      <arg value="-r"/>
      <arg value="src"/>
    </java>
  </target>



</project>

<!-- End of file -->
