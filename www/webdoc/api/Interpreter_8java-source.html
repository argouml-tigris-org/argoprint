<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>ArgoPrint: Interpreter.java Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.4 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Packages</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a></div>
<h1>Interpreter.java</h1><a href="Interpreter_8java.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">//$Id$</span>
00002 <span class="comment">//Copyright (c) 2003, Mikael Albertsson, Mattias Danielsson, Per Engström, </span>
00003 <span class="comment">//Fredrik Gröndahl, Martin Gyllensten, Anna Kent, Anders Olsson, </span>
00004 <span class="comment">//Mattias Sidebäck.</span>
00005 <span class="comment">//All rights reserved.</span>
00006 <span class="comment">//</span>
00007 <span class="comment">//Redistribution and use in source and binary forms, with or without </span>
00008 <span class="comment">//modification, are permitted provided that the following conditions are met:</span>
00009 <span class="comment">//</span>
00010 <span class="comment">//* Redistributions of source code must retain the above copyright notice, </span>
00011 <span class="comment">//  this list of conditions and the following disclaimer.</span>
00012 <span class="comment">// </span>
00013 <span class="comment">//* Redistributions in binary form must reproduce the above copyright </span>
00014 <span class="comment">//  notice, this list of conditions and the following disclaimer in the </span>
00015 <span class="comment">//  documentation and/or other materials provided with the distribution.</span>
00016 <span class="comment">//</span>
00017 <span class="comment">//* Neither the name of the University of Linköping nor the names of its </span>
00018 <span class="comment">//  contributors may be used to endorse or promote products derived from </span>
00019 <span class="comment">//  this software without specific prior written permission. </span>
00020 <span class="comment">//</span>
00021 <span class="comment">//THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" </span>
00022 <span class="comment">//AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE </span>
00023 <span class="comment">//IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE </span>
00024 <span class="comment">//ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE </span>
00025 <span class="comment">//LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR </span>
00026 <span class="comment">//CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF </span>
00027 <span class="comment">//SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS </span>
00028 <span class="comment">//INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN </span>
00029 <span class="comment">//CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) </span>
00030 <span class="comment">//ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF </span>
00031 <span class="comment">//THE POSSIBILITY OF SUCH DAMAGE.</span>
00032 
00033 
00034 <span class="keyword">package </span>org.argoprint.engine.interpreters;
00035 
00036 <span class="keyword">import</span> java.util.Vector;
00037 <span class="keyword">import</span> org.w3c.dom.*;
00038 <span class="keyword">import</span> org.argoprint.ArgoPrintDataSource;
00039 <span class="keyword">import</span> org.argoprint.engine.*;
00040 <span class="comment"></span>
00041 <span class="comment">/**</span>
00042 <span class="comment"> * Superclass for the interpreters. This abstract class implements the chain </span>
00043 <span class="comment"> * of responsibility design pattern. All argoprint specific elements are </span>
00044 <span class="comment"> * handled by classes extending this class. </span>
00045 <span class="comment"> */</span>
<a name="l00046"></a><a class="code" href="classorg_1_1argoprint_1_1engine_1_1interpreters_1_1Interpreter.html">00046</a> <span class="keyword">abstract</span> <span class="keyword">public</span> <span class="keyword">class </span><a class="code" href="classorg_1_1argoprint_1_1engine_1_1interpreters_1_1Interpreter.html">Interpreter</a>{<span class="comment"></span>
00047 <span class="comment">    /**</span>
00048 <span class="comment">     * The namespace prefix identifying the elements that shall be processed.</span>
00049 <span class="comment">     */</span>
<a name="l00050"></a><a class="code" href="classorg_1_1argoprint_1_1engine_1_1interpreters_1_1Interpreter.html#t0">00050</a>     <span class="keyword">protected</span> <span class="keyword">static</span> <span class="keyword">final</span> String <a class="code" href="classorg_1_1argoprint_1_1engine_1_1interpreters_1_1Interpreter.html#t0">PREFIX</a> = <span class="stringliteral">"ap"</span>;
00051     <span class="keyword">private</span> String _tagName;
00052     <span class="keyword">private</span> <a class="code" href="classorg_1_1argoprint_1_1engine_1_1interpreters_1_1Interpreter.html">Interpreter</a> _nextHandler;<span class="comment"></span>
00053 <span class="comment">    /**</span>
00054 <span class="comment">     * A reference to the first handler in the chain of responsibility, </span>
00055 <span class="comment">     * for recursion.</span>
00056 <span class="comment">     */</span>
<a name="l00057"></a><a class="code" href="classorg_1_1argoprint_1_1engine_1_1interpreters_1_1Interpreter.html#p0">00057</a>     <span class="keyword">protected</span> <a class="code" href="classorg_1_1argoprint_1_1engine_1_1interpreters_1_1Interpreter.html">Interpreter</a> <a class="code" href="classorg_1_1argoprint_1_1engine_1_1interpreters_1_1Interpreter.html#p0">_firstHandler</a>;<span class="comment"></span>
00058 <span class="comment">    /**</span>
00059 <span class="comment">     * A reference to the data source to use.</span>
00060 <span class="comment">     */</span>
<a name="l00061"></a><a class="code" href="classorg_1_1argoprint_1_1engine_1_1interpreters_1_1Interpreter.html#p1">00061</a>     <span class="keyword">protected</span> <a class="code" href="interfaceorg_1_1argoprint_1_1ArgoPrintDataSource.html">ArgoPrintDataSource</a> <a class="code" href="classorg_1_1argoprint_1_1engine_1_1interpreters_1_1Interpreter.html#p1">_dataSource</a>;
00062     
<a name="l00063"></a><a class="code" href="classorg_1_1argoprint_1_1engine_1_1interpreters_1_1Interpreter.html#a0">00063</a>     <span class="keyword">public</span> <a class="code" href="classorg_1_1argoprint_1_1engine_1_1interpreters_1_1Interpreter.html#a0">Interpreter</a>() {
00064     }
00065     <span class="comment"></span>
00066 <span class="comment">    /**</span>
00067 <span class="comment">     * @param tagName The name of the tag that this Interpreter can process.</span>
00068 <span class="comment">     * @param dataSource The ArgoPrintDataSource that this Interpreter should</span>
00069 <span class="comment">     * fetch data from.</span>
00070 <span class="comment">     */</span>
<a name="l00071"></a><a class="code" href="classorg_1_1argoprint_1_1engine_1_1interpreters_1_1Interpreter.html#a1">00071</a>     <span class="keyword">public</span> <a class="code" href="classorg_1_1argoprint_1_1engine_1_1interpreters_1_1Interpreter.html#a0">Interpreter</a>(String tagName, <a class="code" href="interfaceorg_1_1argoprint_1_1ArgoPrintDataSource.html">ArgoPrintDataSource</a> dataSource) {
00072         _tagName = tagName;
00073         <a class="code" href="classorg_1_1argoprint_1_1engine_1_1interpreters_1_1Interpreter.html#p1">_dataSource</a> = dataSource;
00074         _nextHandler = null;
00075         <a class="code" href="classorg_1_1argoprint_1_1engine_1_1interpreters_1_1Interpreter.html#p0">_firstHandler</a> = null;
00076     }
00077     <span class="comment"></span>
00078 <span class="comment">    /**</span>
00079 <span class="comment">     * Specifies the next Interpreter in the chain of responsibility.</span>
00080 <span class="comment">     * </span>
00081 <span class="comment">     * @param nextHandler The next Interpreter.</span>
00082 <span class="comment">     */</span>
<a name="l00083"></a><a class="code" href="classorg_1_1argoprint_1_1engine_1_1interpreters_1_1Interpreter.html#a2">00083</a>     <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classorg_1_1argoprint_1_1engine_1_1interpreters_1_1Interpreter.html#a2">setNextHandler</a>(<a class="code" href="classorg_1_1argoprint_1_1engine_1_1interpreters_1_1Interpreter.html">Interpreter</a> nextHandler) {
00084         _nextHandler = nextHandler;
00085     }
00086     <span class="comment"></span>
00087 <span class="comment">    /**</span>
00088 <span class="comment">     * Specifies the first Interpreter in the chain of responsibility.</span>
00089 <span class="comment">     * </span>
00090 <span class="comment">     * @param firstHandler The first Interpreter.</span>
00091 <span class="comment">     */</span>
<a name="l00092"></a><a class="code" href="classorg_1_1argoprint_1_1engine_1_1interpreters_1_1Interpreter.html#a3">00092</a>     <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classorg_1_1argoprint_1_1engine_1_1interpreters_1_1Interpreter.html#a3">setFirstHandler</a>(<a class="code" href="classorg_1_1argoprint_1_1engine_1_1interpreters_1_1Interpreter.html">Interpreter</a> firstHandler) {
00093     <a class="code" href="classorg_1_1argoprint_1_1engine_1_1interpreters_1_1Interpreter.html#p0">_firstHandler</a> = firstHandler;
00094     }
00095     <span class="comment"></span>
00096 <span class="comment">    /**</span>
00097 <span class="comment">     * Processes the Node or sends it to the next Interpreter.</span>
00098 <span class="comment">     *  </span>
00099 <span class="comment">     * @param tagNode The Node to handle.</span>
00100 <span class="comment">     * @param env The environment in which the Node is to be processed.</span>
00101 <span class="comment">     */</span>
<a name="l00102"></a><a class="code" href="classorg_1_1argoprint_1_1engine_1_1interpreters_1_1Interpreter.html#a4">00102</a>     <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classorg_1_1argoprint_1_1engine_1_1interpreters_1_1Interpreter.html#a4">handleTag</a>(Node tagNode, <a class="code" href="classorg_1_1argoprint_1_1engine_1_1Environment.html">Environment</a> env)
00103     <span class="keywordflow">throws</span> Exception {
00104     <span class="keywordflow">if</span> (<a class="code" href="classorg_1_1argoprint_1_1engine_1_1interpreters_1_1Interpreter.html#b1">canHandle</a>(tagNode))
00105         <a class="code" href="classorg_1_1argoprint_1_1engine_1_1interpreters_1_1Interpreter.html#b0">processTag</a>(tagNode, env);
00106     <span class="keywordflow">else</span>
00107         <span class="keywordflow">if</span> (_nextHandler == null)
00108         <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(<span class="stringliteral">"The last Interpreter in the chain could not handle the Node."</span>);
00109         <span class="keywordflow">else</span>
00110         _nextHandler.<a class="code" href="classorg_1_1argoprint_1_1engine_1_1interpreters_1_1Interpreter.html#a4">handleTag</a>(tagNode, env);   
00111     }
00112 <span class="comment"></span>
00113 <span class="comment">    /**</span>
00114 <span class="comment">     * Processes a tag.</span>
00115 <span class="comment">     * </span>
00116 <span class="comment">     * @param tagNode The tag to process.</span>
00117 <span class="comment">     * @param env The environment in which to process it.</span>
00118 <span class="comment">     */</span>
00119     <span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keywordtype">void</span> <a class="code" href="classorg_1_1argoprint_1_1engine_1_1interpreters_1_1Interpreter.html#b0">processTag</a>(Node tagNode, <a class="code" href="classorg_1_1argoprint_1_1engine_1_1Environment.html">Environment</a> env) <span class="keywordflow">throws</span> Exception;
00120 <span class="comment"></span>
00121 <span class="comment">    /**</span>
00122 <span class="comment">     * Checks if this Interpreter can handle this Node.</span>
00123 <span class="comment">     * </span>
00124 <span class="comment">     * @param tagNode The Node to check.</span>
00125 <span class="comment">     */</span>
<a name="l00126"></a><a class="code" href="classorg_1_1argoprint_1_1engine_1_1interpreters_1_1Interpreter.html#b1">00126</a>     <span class="keyword">protected</span> <span class="keywordtype">boolean</span> <a class="code" href="classorg_1_1argoprint_1_1engine_1_1interpreters_1_1Interpreter.html#b1">canHandle</a>(Node tagNode){
00127     <span class="keywordflow">if</span> (tagNode.getNodeType() == Node.ELEMENT_NODE &amp;&amp; tagNode.getLocalName().equals(_tagName) &amp;&amp; tagNode.getPrefix().equals(<a class="code" href="classorg_1_1argoprint_1_1engine_1_1interpreters_1_1Interpreter.html#t0">PREFIX</a>)) {
00128         <span class="keywordflow">return</span> <span class="keyword">true</span>;
00129     }
00130     <span class="keywordflow">else</span> {
00131         <span class="keywordflow">return</span> <span class="keyword">false</span>;
00132     }
00133     }
00134     <span class="comment"></span>
00135 <span class="comment">    /**</span>
00136 <span class="comment">     * Uses the attributes what and iterator to call the data source and </span>
00137 <span class="comment">     * return the value.</span>
00138 <span class="comment">     * </span>
00139 <span class="comment">     * @param callAttr The name of the attribute containing the call.</span>
00140 <span class="comment">     * @param attributes A NamedNodeMap of map of attributes that must contain </span>
00141 <span class="comment">     * at least the attribute what.</span>
00142 <span class="comment">     * @param env The Environment in which to process the call.</span>
00143 <span class="comment">     * @return The Object as returned from the data source.</span>
00144 <span class="comment">     * @throws Exception</span>
00145 <span class="comment">     */</span>
<a name="l00146"></a><a class="code" href="classorg_1_1argoprint_1_1engine_1_1interpreters_1_1Interpreter.html#b2">00146</a>     <span class="keyword">protected</span> Object <a class="code" href="classorg_1_1argoprint_1_1engine_1_1interpreters_1_1Interpreter.html#b2">callDataSource</a>(String callAttr, NamedNodeMap attributes, <a class="code" href="classorg_1_1argoprint_1_1engine_1_1Environment.html">Environment</a> env) 
00147     <span class="keywordflow">throws</span> Exception {
00148     Node callAttrNode = attributes.getNamedItem(callAttr);
00149     <span class="keywordflow">if</span> (callAttrNode == null)
00150         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classorg_1_1argoprint_1_1engine_1_1interpreters_1_1BadTemplateException.html">BadTemplateException</a>(_tagName + <span class="stringliteral">" tag contains no "</span> + callAttr +<span class="stringliteral">" attribute."</span>);
00151     Object returnValue;
00152     Node iteratorAttribute = attributes.getNamedItem(<span class="stringliteral">"iterator"</span>);
00153     <span class="keywordflow">if</span> (iteratorAttribute == null)
00154         returnValue = <a class="code" href="classorg_1_1argoprint_1_1engine_1_1interpreters_1_1Interpreter.html#p1">_dataSource</a>.<a class="code" href="interfaceorg_1_1argoprint_1_1ArgoPrintDataSource.html#a0">caller</a>(callAttrNode.getNodeValue());
00155     <span class="keywordflow">else</span> {
00156         <span class="keywordflow">if</span> (!env.existsIterator(iteratorAttribute.getNodeValue()))
00157         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classorg_1_1argoprint_1_1engine_1_1interpreters_1_1BadTemplateException.html">BadTemplateException</a>(<span class="stringliteral">"Value of iterator in "</span> + _tagName + 
00158                            <span class="stringliteral">" tag does not correspond to a valid iterator. "</span>
00159                            + iteratorAttribute.getNodeValue());
00160         
00161         <a class="code" href="classorg_1_1argoprint_1_1engine_1_1ArgoPrintIterator.html">ArgoPrintIterator</a> iterator = env.getIterator(iteratorAttribute.getNodeValue());
00162         returnValue = <a class="code" href="classorg_1_1argoprint_1_1engine_1_1interpreters_1_1Interpreter.html#p1">_dataSource</a>.<a class="code" href="interfaceorg_1_1argoprint_1_1ArgoPrintDataSource.html#a0">caller</a>(callAttrNode.getNodeValue(), iterator.<a class="code" href="classorg_1_1argoprint_1_1engine_1_1ArgoPrintIterator.html#a4">currentObject</a>());
00163     }
00164     <span class="keywordflow">return</span> returnValue;
00165     }
00166         <span class="comment"></span>
00167 <span class="comment">    /**</span>
00168 <span class="comment">     * Checks if Node has a certain name.</span>
00169 <span class="comment">     * </span>
00170 <span class="comment">     * @param node The node to check</span>
00171 <span class="comment">     * @param prefix The namespace prefix</span>
00172 <span class="comment">     * @param localName The local name</span>
00173 <span class="comment">     * @return</span>
00174 <span class="comment">     */</span>
<a name="l00175"></a><a class="code" href="classorg_1_1argoprint_1_1engine_1_1interpreters_1_1Interpreter.html#b3">00175</a>     <span class="keyword">protected</span> <span class="keywordtype">boolean</span> <a class="code" href="classorg_1_1argoprint_1_1engine_1_1interpreters_1_1Interpreter.html#b3">isNodeNamed</a>(Node node, String prefix, String localName) {
00176     <span class="keywordflow">if</span> ((node.getLocalName() == null) || node.getPrefix() == null)
00177         <span class="keywordflow">return</span> <span class="keyword">false</span>;
00178     <span class="keywordflow">else</span>
00179         <span class="keywordflow">return</span> (node.getLocalName().equals(localName) &amp;&amp; node.getPrefix().equals(prefix));
00180     }
00181     <span class="comment"></span>
00182 <span class="comment">    /**</span>
00183 <span class="comment">     * Constructs a Vector from a NodeList.</span>
00184 <span class="comment">     * </span>
00185 <span class="comment">     * @param nodeList The NodeList</span>
00186 <span class="comment">     * @return A vector with the same ordering as the NodeList.</span>
00187 <span class="comment">     */</span>
<a name="l00188"></a><a class="code" href="classorg_1_1argoprint_1_1engine_1_1interpreters_1_1Interpreter.html#b4">00188</a>     <span class="keyword">protected</span> Vector <a class="code" href="classorg_1_1argoprint_1_1engine_1_1interpreters_1_1Interpreter.html#b4">getVector</a>(NodeList nodeList) { 
00189     <span class="keywordtype">int</span> numNodes = nodeList.getLength();
00190     Vector vector = <span class="keyword">new</span> Vector(numNodes);
00191     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; numNodes; i++){
00192         vector.add(i, nodeList.item(i));
00193     }
00194     <span class="keywordflow">return</span> vector;
00195     }
00196     <span class="comment"></span>
00197 <span class="comment">    /**</span>
00198 <span class="comment">     * Recurses on every Node in the Vector.</span>
00199 <span class="comment">     * </span>
00200 <span class="comment">     * @param nodes A vector containing Nodes.</span>
00201 <span class="comment">     * @param env</span>
00202 <span class="comment">     * @throws Exception</span>
00203 <span class="comment">     */</span>
<a name="l00204"></a><a class="code" href="classorg_1_1argoprint_1_1engine_1_1interpreters_1_1Interpreter.html#b5">00204</a>     <span class="keyword">protected</span> <span class="keywordtype">void</span> <a class="code" href="classorg_1_1argoprint_1_1engine_1_1interpreters_1_1Interpreter.html#b5">recurse</a>(Vector nodes, <a class="code" href="classorg_1_1argoprint_1_1engine_1_1Environment.html">Environment</a> env) <span class="keywordflow">throws</span> Exception {
00205     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; nodes.size(); i++) {
00206         <a class="code" href="classorg_1_1argoprint_1_1engine_1_1interpreters_1_1Interpreter.html#p0">_firstHandler</a>.<a class="code" href="classorg_1_1argoprint_1_1engine_1_1interpreters_1_1Interpreter.html#a4">handleTag</a>((Node)nodes.get(i), env);
00207     }
00208     }
00209 }
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Tue Dec 2 22:50:56 2003 for ArgoPrint by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.4 </small></address>
</body>
</html>
