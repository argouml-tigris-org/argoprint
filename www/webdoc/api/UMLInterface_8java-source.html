<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>ArgoPrint: UMLInterface.java Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.4 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Packages</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a></div>
<h1>UMLInterface.java</h1><a href="UMLInterface_8java.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">//$Id$</span>
00002 <span class="comment">//Copyright (c) 2003, Mikael Albertsson, Mattias Danielsson, Per Engström, </span>
00003 <span class="comment">//Fredrik Gröndahl, Martin Gyllensten, Anna Kent, Anders Olsson, </span>
00004 <span class="comment">//Mattias Sidebäck.</span>
00005 <span class="comment">//All rights reserved.</span>
00006 <span class="comment">//</span>
00007 <span class="comment">//Redistribution and use in source and binary forms, with or without </span>
00008 <span class="comment">//modification, are permitted provided that the following conditions are met:</span>
00009 <span class="comment">//</span>
00010 <span class="comment">//* Redistributions of source code must retain the above copyright notice, </span>
00011 <span class="comment">//  this list of conditions and the following disclaimer.</span>
00012 <span class="comment">// </span>
00013 <span class="comment">//* Redistributions in binary form must reproduce the above copyright </span>
00014 <span class="comment">//  notice, this list of conditions and the following disclaimer in the </span>
00015 <span class="comment">//  documentation and/or other materials provided with the distribution.</span>
00016 <span class="comment">//</span>
00017 <span class="comment">//* Neither the name of the University of Linköping nor the names of its </span>
00018 <span class="comment">//  contributors may be used to endorse or promote products derived from </span>
00019 <span class="comment">//  this software without specific prior written permission. </span>
00020 <span class="comment">//</span>
00021 <span class="comment">//THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" </span>
00022 <span class="comment">//AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE </span>
00023 <span class="comment">//IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE </span>
00024 <span class="comment">//ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE </span>
00025 <span class="comment">//LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR </span>
00026 <span class="comment">//CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF </span>
00027 <span class="comment">//SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS </span>
00028 <span class="comment">//INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN </span>
00029 <span class="comment">//CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) </span>
00030 <span class="comment">//ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF </span>
00031 <span class="comment">//THE POSSIBILITY OF SUCH DAMAGE.</span>
00032 
<a name="l00033"></a><a class="code" href="namespaceorg_1_1argoprint_1_1uml__interface.html">00033</a> <span class="keyword">package </span>org.argoprint.uml_interface;
00034 
00035 <span class="keyword">import</span> org.argoprint.*;
00036 
00037 <span class="keyword">import</span> java.awt.event.ActionEvent;
00038 
00039 <span class="keyword">import</span> java.io.File;
00040 <span class="keyword">import</span> java.io.FileNotFoundException;
00041 <span class="keyword">import</span> java.io.FileOutputStream;
00042 <span class="keyword">import</span> java.io.IOException;
00043 
00044 <span class="keyword">import</span> javax.swing.JFileChooser;
00045 <span class="keyword">import</span> javax.swing.JOptionPane;
00046 <span class="keyword">import</span> javax.swing.filechooser.FileFilter;
00047 
00048 <span class="keyword">import</span> org.apache.log4j.Logger;
00049 <span class="keyword">import</span> org.argouml.kernel.Project;
00050 <span class="keyword">import</span> org.argouml.kernel.ProjectManager;
00051 <span class="keyword">import</span> org.argouml.kernel.ProjectMember;
00052 
00053 <span class="keyword">import</span> org.argouml.ui.ArgoDiagram;
00054 <span class="keyword">import</span> org.argouml.ui.ProjectBrowser;
00055 
00056 <span class="keyword">import</span> org.argouml.uml.diagram.ui.*;
00057 
00058 <span class="keyword">import</span> org.argouml.util.FileFilters;
00059 <span class="keyword">import</span> org.argouml.util.SuffixFilter;
00060 <span class="keyword">import</span> org.argouml.util.osdep.OsUtil;
00061 
00062 <span class="keyword">import</span> org.argouml.model.ModelFacade;
00063 <span class="keyword">import</span> org.argouml.application.api.*;
00064 
00065 <span class="keyword">import</span> org.tigris.gef.base.CmdSaveEPS;
00066 <span class="keyword">import</span> org.tigris.gef.base.CmdSaveGIF;
00067 <span class="keyword">import</span> org.tigris.gef.base.CmdSaveGraphics;
00068 <span class="keyword">import</span> org.tigris.gef.base.CmdSavePS;
00069 <span class="keyword">import</span> org.tigris.gef.base.CmdSaveSVG;
00070 <span class="keyword">import</span> org.tigris.gef.base.Diagram;
00071 <span class="keyword">import</span> org.tigris.gef.util.Util;
00072 
00073 <span class="keyword">import</span> java.util.*;
00074 <span class="keyword">import</span> java.io.*;
00075 <span class="keyword">import</span> java.awt.Rectangle;
00076 
00077 <span class="keyword">import</span> java.lang.reflect.*;
00078 <span class="keyword">import</span> java.lang.Class;
00079 
00080 <span class="keyword">import</span> java.lang.Boolean;
00081 
00082 <span class="keyword">import</span> org.tigris.gef.base.*;
00083 <span class="keyword">import</span> org.tigris.gef.persistence.*;
00084 <span class="comment"></span>
00085 <span class="comment">/** </span>
00086 <span class="comment"> * The class ArgoPrint uses to interface to the ArgoUML model.</span>
00087 <span class="comment"> * It primarily communicates with ModelFacade using java.lang.reflect.*</span>
00088 <span class="comment"> * To save diagrams gef is used. TODO: fix bug that causes only</span>
00089 <span class="comment"> * the open diagram to be saved correctly.</span>
00090 <span class="comment"> *</span>
00091 <span class="comment"> * @author matda701, Mattias Danielsson</span>
00092 <span class="comment"> */</span>
<a name="l00093"></a><a class="code" href="classorg_1_1argoprint_1_1uml__interface_1_1UMLInterface.html">00093</a> <span class="keyword">public</span> <span class="keyword">class </span><a class="code" href="classorg_1_1argoprint_1_1uml__interface_1_1UMLInterface.html">UMLInterface</a> 
00094     <span class="keyword">implements</span> <a class="code" href="interfaceorg_1_1argoprint_1_1ArgoPrintDataSource.html">ArgoPrintDataSource</a>{
<a name="l00095"></a><a class="code" href="classorg_1_1argoprint_1_1uml__interface_1_1UMLInterface.html#s0">00095</a>     <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String <a class="code" href="classorg_1_1argoprint_1_1uml__interface_1_1UMLInterface.html#s0">separator</a> = <span class="stringliteral">"/"</span>;
00096 <span class="comment"></span>
00097 <span class="comment">    /**</span>
00098 <span class="comment">     * The ArgoUML project that ArgoPrint is applied to. Must be</span>
00099 <span class="comment">     * set prior to use by using the setProject(..) method</span>
00100 <span class="comment">     */</span>
00101     <span class="keyword">private</span> Project _project;
00102 <span class="comment"></span>
00103 <span class="comment">    /**</span>
00104 <span class="comment">     * The ArgoUML projectbrowser that ArgoPrint is applied to. Must be</span>
00105 <span class="comment">     * set prior to use by using the setProjectBrowser(..) method</span>
00106 <span class="comment">     */</span>
00107     <span class="keyword">private</span> ProjectBrowser _projectBrowser;
00108     <span class="comment"></span>
00109 <span class="comment">    /**</span>
00110 <span class="comment">     * A reference to the ModelFacade</span>
00111 <span class="comment">     */</span>
00112     <span class="keyword">private</span> ModelFacade _facade; 
00113 <span class="comment"></span>
00114 <span class="comment">    /**</span>
00115 <span class="comment">     * A reference to the ArgoUML Logger. (Uses log4java) </span>
00116 <span class="comment">     */</span>
00117     <span class="keyword">private</span> Logger _log;
00118     <span class="comment"></span>
00119 <span class="comment">    /**</span>
00120 <span class="comment">     * The ArgoPrint output dir. Used when saving diagrams as pictures. </span>
00121 <span class="comment">     * Must be set prior to use.</span>
00122 <span class="comment">     */</span>
<a name="l00123"></a><a class="code" href="classorg_1_1argoprint_1_1uml__interface_1_1UMLInterface.html#q0">00123</a>     String <a class="code" href="classorg_1_1argoprint_1_1uml__interface_1_1UMLInterface.html#q0">_outputDir</a>;
00124 <span class="comment"></span>
00125 <span class="comment">    ////////////////////////////////////////////////////////////////</span>
00126 <span class="comment"></span>    <span class="comment">// constructors</span>
00127     <span class="comment"></span>
00128 <span class="comment">    /**</span>
00129 <span class="comment">     * Constructor</span>
00130 <span class="comment">     */</span>
<a name="l00131"></a><a class="code" href="classorg_1_1argoprint_1_1uml__interface_1_1UMLInterface.html#a0">00131</a>     <span class="keyword">public</span> <a class="code" href="classorg_1_1argoprint_1_1uml__interface_1_1UMLInterface.html#a0">UMLInterface</a>() {
00132     <span class="comment">//super( "action.save-graphics", NO_ICON);</span>
00133     <span class="comment">//_facade = new ModelFacade(); </span>
00134     _facade = ModelFacade.getFacade();
00135     }
00136 <span class="comment"></span>
00137 <span class="comment">    /**</span>
00138 <span class="comment">     * Initializes fields prior to usage. Can be used instead of the </span>
00139 <span class="comment">     * individual setters.</span>
00140 <span class="comment">     */</span>
<a name="l00141"></a><a class="code" href="classorg_1_1argoprint_1_1uml__interface_1_1UMLInterface.html#a1">00141</a>     <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classorg_1_1argoprint_1_1uml__interface_1_1UMLInterface.html#a1">initialize</a>(Logger log){
00142     _log = log;
00143     _projectBrowser = ProjectBrowser.getInstance();
00144     _project = ProjectManager.getManager().getCurrentProject();
00145     }
00146 <span class="comment"></span>
00147 <span class="comment">    ////////////////////////////////////////////////////////////////</span>
00148 <span class="comment"></span>    <span class="comment">// setters</span>
00149 <span class="comment"></span>
00150 <span class="comment">    /**</span>
00151 <span class="comment">     * Sets the logger (_log) to logger</span>
00152 <span class="comment">     */</span>
<a name="l00153"></a><a class="code" href="classorg_1_1argoprint_1_1uml__interface_1_1UMLInterface.html#a2">00153</a>     <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classorg_1_1argoprint_1_1uml__interface_1_1UMLInterface.html#a2">setLog</a>(Logger logger){ _log = logger; }
00154     <span class="comment"></span>
00155 <span class="comment">    /**</span>
00156 <span class="comment">     * Sets the projectBrowswer to browser</span>
00157 <span class="comment">     */</span>
<a name="l00158"></a><a class="code" href="classorg_1_1argoprint_1_1uml__interface_1_1UMLInterface.html#a3">00158</a>     <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classorg_1_1argoprint_1_1uml__interface_1_1UMLInterface.html#a3">setProjectBrowser</a>(ProjectBrowser browser){
00159     _projectBrowser = browser;
00160     }
00161     <span class="comment"></span>
00162 <span class="comment">    /**</span>
00163 <span class="comment">     * Sets the project to proj</span>
00164 <span class="comment">     */</span>
<a name="l00165"></a><a class="code" href="classorg_1_1argoprint_1_1uml__interface_1_1UMLInterface.html#a4">00165</a>     <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classorg_1_1argoprint_1_1uml__interface_1_1UMLInterface.html#a4">setProject</a>(Project proj){ _project = proj; }
00166 <span class="comment"></span>
00167 <span class="comment">    /**</span>
00168 <span class="comment">     * Sets the outputPath to path</span>
00169 <span class="comment">     */</span>
<a name="l00170"></a><a class="code" href="classorg_1_1argoprint_1_1uml__interface_1_1UMLInterface.html#a5">00170</a>     <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classorg_1_1argoprint_1_1uml__interface_1_1UMLInterface.html#a5">setOutputDir</a>(String dir){ <a class="code" href="classorg_1_1argoprint_1_1uml__interface_1_1UMLInterface.html#q0">_outputDir</a> = <span class="keyword">new</span> String(dir); }
00171 <span class="comment"></span>
00172 <span class="comment">    ////////////////////////////////////////////////////////////////</span>
00173 <span class="comment"></span>    <span class="comment">// main methods</span>
00174     <span class="comment"></span>
00175 <span class="comment">    /**</span>
00176 <span class="comment">     * Checks if ModelFacade has a method named method. Depracated!</span>
00177 <span class="comment">     */</span>
<a name="l00178"></a><a class="code" href="classorg_1_1argoprint_1_1uml__interface_1_1UMLInterface.html#a6">00178</a>     <span class="keyword">public</span> <span class="keywordtype">boolean</span> <a class="code" href="classorg_1_1argoprint_1_1uml__interface_1_1UMLInterface.html#a6">hasMethod</a>(String method){
00179     Class c = _facade.getClass();
00180     Method[] theMethods = c.getMethods();
00181       
00182     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; theMethods.length; i++) {
00183         <span class="keywordflow">if</span>(method.equals(theMethods[i].getName())){
00184         <span class="keywordflow">return</span> <span class="keyword">true</span>;
00185         }
00186     }
00187     <span class="keywordflow">return</span> <span class="keyword">false</span>;
00188     }
00189     <span class="comment"></span>
00190 <span class="comment">    /**</span>
00191 <span class="comment">     * Calls method named call in ModelFacade </span>
00192 <span class="comment">     * returns Object, which often is String or Collection</span>
00193 <span class="comment">     * iteratorObject is the argument for the method </span>
00194 <span class="comment">     */</span>
<a name="l00195"></a><a class="code" href="classorg_1_1argoprint_1_1uml__interface_1_1UMLInterface.html#a7">00195</a>     <span class="keyword">public</span> Object <a class="code" href="classorg_1_1argoprint_1_1uml__interface_1_1UMLInterface.html#a7">caller</a>(String call, Object iteratorObject)
00196     <span class="keywordflow">throws</span> Exception{
00197     <span class="comment">//_log.info("Arg call: " + call + " Arg: " + </span>
00198     <span class="comment">//    _facade.getName(iteratorObject)); </span>
00199     Class c = _facade.getClass();
00200     Method[] theMethods = c.getMethods();   
00201     
00202     Object args[] = <span class="keyword">new</span> Object[1];
00203     args[0] = iteratorObject;
00204 
00205     <span class="keywordflow">if</span>(call.endsWith(<span class="keyword">new</span> String(<span class="stringliteral">"()"</span>))){
00206         <span class="keywordtype">int</span> callLength = call.length()-2;
00207         
00208         String callName = <span class="keyword">new</span> String(call.substring(0, callLength));
00209         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; theMethods.length; i++) {
00210         
00211         <span class="keywordflow">if</span>(callName.equals(theMethods[i].getName())){
00212             <span class="keywordflow">try</span>{
00213             <span class="keywordflow">return</span> theMethods[i].invoke(null, args);
00214             }
00215             <span class="keywordflow">catch</span> (IllegalAccessException e){
00216             _log.info(<span class="stringliteral">"Crash"</span> + e.getMessage());
00217             }
00218             <span class="keywordflow">catch</span> (IllegalArgumentException e){
00219             _log.info(<span class="stringliteral">"Crash"</span> + e.getMessage());
00220             }
00221             <span class="keywordflow">catch</span> (InvocationTargetException e){
00222             _log.info(<span class="stringliteral">"Crash"</span> + e.getMessage());
00223             }
00224             <span class="keywordflow">catch</span> (NullPointerException e){
00225             _log.info(<span class="stringliteral">"Crash"</span> + e.getMessage());
00226             }
00227             <span class="keywordflow">catch</span> (ExceptionInInitializerError e){
00228             _log.info(<span class="stringliteral">"Crash"</span> + e.getMessage());
00229             }          
00230         }       
00231         }
00232     }
00233     <span class="comment">//throw new Exception("Illegal method call");</span>
00234     <span class="keywordflow">return</span> <span class="keyword">new</span> String(<span class="stringliteral">"Not a known method"</span>);
00235     }
00236 
00237     <span class="comment"></span>
00238 <span class="comment">    /**</span>
00239 <span class="comment">     * Calls method named call in ModelFacade. Used when argument is to</span>
00240 <span class="comment">     * be on of the default. ex. calledMethodName(model) and not an</span>
00241 <span class="comment">     * iteratorObject</span>
00242 <span class="comment">     */</span>
<a name="l00243"></a><a class="code" href="classorg_1_1argoprint_1_1uml__interface_1_1UMLInterface.html#a8">00243</a>     <span class="keyword">public</span> Object <a class="code" href="classorg_1_1argoprint_1_1uml__interface_1_1UMLInterface.html#a7">caller</a>(String call)
00244     <span class="keywordflow">throws</span> Exception{
00245     <span class="comment">//_log.info("call: " + call);</span>
00246     <span class="comment">//Class c = _facade.getClass();</span>
00247     <span class="comment">//Method[] theMethods = c.getMethods();</span>
00248 
00249     <span class="keywordflow">if</span>(call.endsWith(<span class="keyword">new</span> String(<span class="stringliteral">"()"</span>))){
00250        Class c = _facade.getClass();
00251        Method[] theMethods = c.getMethods();
00252        <span class="keywordtype">int</span> callLength = call.length()-2;
00253         
00254         String callName = <span class="keyword">new</span> String(call.substring(0, callLength - 1));
00255         
00256         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; theMethods.length; i++) {
00257         <span class="keywordflow">if</span>(callName.equals(theMethods[i].getName())){
00258             <span class="keywordflow">try</span>{
00259             <span class="keywordflow">return</span> theMethods[i].invoke(null, null);
00260             }
00261             <span class="keywordflow">catch</span> (IllegalAccessException ignore ){
00262             }
00263             <span class="keywordflow">catch</span> (IllegalArgumentException ignore ){
00264             }
00265             <span class="keywordflow">catch</span> (InvocationTargetException ignore ){
00266             }
00267             <span class="keywordflow">catch</span> (NullPointerException ignore ){
00268             }
00269             <span class="keywordflow">catch</span> (ExceptionInInitializerError ignore ){
00270             }          
00271         }       
00272         }
00273     } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(call.endsWith(<span class="keyword">new</span> String(<span class="stringliteral">")"</span>))){
00274         Class c= _facade.getClass();;
00275         Method[] theMethods = c.getMethods();
00276         <span class="keywordtype">int</span> callLength = call.indexOf((<span class="keywordtype">int</span>) <span class="charliteral">'('</span>) + 1;
00277         
00278         String callName = <span class="keyword">new</span> String(call.substring(0, callLength - 1));
00279         String arg = 
00280         <span class="keyword">new</span> String(call.substring(callLength, call.length() - 1));
00281         Object args[] = <span class="keyword">new</span> Object[1];  
00282         Object thisObject = null;
00283 
00284         <span class="keywordflow">if</span>(arg.equals(<span class="keyword">new</span> String(<span class="stringliteral">"model"</span>))){
00285         args[0] = _project.getModel();
00286         <span class="comment">//c = _facade.getClass();</span>
00287         <span class="comment">//theMethods = c.getMethods();</span>
00288         } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(arg.equals(<span class="keyword">new</span> String(<span class="stringliteral">"project"</span>))){
00289         thisObject = _project;
00290         args = null;
00291         c = _project.getClass();
00292         <span class="keywordtype">int</span> vectorLen = c.getMethods().length;
00293         theMethods = <span class="keyword">new</span> Method[vectorLen];
00294         theMethods = c.getMethods();
00295         } <span class="keywordflow">else</span> {
00296         <span class="comment">//c = _facade.getClass();</span>
00297         <span class="comment">//theMethods = c.getMethods();</span>
00298         }
00299  
00300         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; theMethods.length; i++) {
00301         <span class="keywordflow">if</span>(callName.equals(theMethods[i].getName())){
00302             <span class="keywordflow">try</span>{    
00303             <span class="comment">//_log.info("Call hit: " + arg + " " + callName);</span>
00304             <span class="comment">//Object args[] = new Object[1];</span>
00305             <span class="comment">//args[0] = _project.getModel(); </span>
00306             <span class="keywordflow">return</span> theMethods[i].invoke(thisObject, 
00307                             args);
00308             }<span class="keywordflow">catch</span>(Exception e){
00309             <span class="keywordflow">throw</span> e;
00310             }
00311         }       
00312         }
00313         
00314         <span class="comment">//return null;</span>
00315     }
00316     <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(<span class="stringliteral">"Illegal method call"</span>);
00317     <span class="comment">//return new String("Illegal method call");</span>
00318     }
00319     <span class="comment"></span>
00320 <span class="comment">    /**</span>
00321 <span class="comment">     * Calls method named call in ModelFacade </span>
00322 <span class="comment">     * returns boolean, caller(..) can be used instead but</span>
00323 <span class="comment">     * then Booolean.booleanValue() must be used. Depracated! </span>
00324 <span class="comment">     */</span>
<a name="l00325"></a><a class="code" href="classorg_1_1argoprint_1_1uml__interface_1_1UMLInterface.html#a9">00325</a>     <span class="keyword">public</span> <span class="keywordtype">boolean</span> <a class="code" href="classorg_1_1argoprint_1_1uml__interface_1_1UMLInterface.html#a9">booleanCaller</a>(String call, Object args[]){
00326     <span class="keywordflow">if</span>(<a class="code" href="classorg_1_1argoprint_1_1uml__interface_1_1UMLInterface.html#a6">hasMethod</a>(call)){
00327         Class c = _facade.getClass();
00328         Method[] theMethods = c.getMethods();   
00329         
00330         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; theMethods.length; i++) {
00331         <span class="keywordflow">if</span>(call.equals(theMethods[i].getName())){
00332             <span class="keywordflow">try</span>{
00333             Object answer = theMethods[i].invoke(null, args);
00334             <span class="keywordflow">return</span> ((Boolean)answer).booleanValue();
00335             <span class="comment">//break;</span>
00336             }
00337             <span class="keywordflow">catch</span>(IllegalAccessException ignore ){
00338             
00339             }
00340             <span class="keywordflow">catch</span>(IllegalArgumentException ignore ){
00341                
00342             }
00343             <span class="keywordflow">catch</span>(InvocationTargetException ignore ){
00344             
00345             }
00346             <span class="keywordflow">catch</span>(NullPointerException ignore ){
00347             
00348             }
00349             <span class="keywordflow">catch</span>(ExceptionInInitializerError ignore ){
00350             
00351             }           
00352         }       
00353         }
00354     }
00355     <span class="comment">//should be throw exeption</span>
00356     <span class="keywordflow">return</span> <span class="keyword">false</span>;
00357     <span class="comment">//return new String("Not a known method");</span>
00358     }
00359 <span class="comment"></span>
00360 <span class="comment">    /**</span>
00361 <span class="comment">     * Returns all diagrams in the project. TODO: Figure out a clever</span>
00362 <span class="comment">     * way to invoke with caller. Solved by using reflections on Project</span>
00363 <span class="comment">     * Therefor not needed.</span>
00364 <span class="comment">     */</span>    
<a name="l00365"></a><a class="code" href="classorg_1_1argoprint_1_1uml__interface_1_1UMLInterface.html#a10">00365</a>     <span class="keyword">public</span> Collection <a class="code" href="classorg_1_1argoprint_1_1uml__interface_1_1UMLInterface.html#a10">getAllDiagrams</a>(){
00366     <span class="keywordflow">return</span> _project.getDiagrams();
00367     }
00368 
00369 <span class="comment"></span>
00370 <span class="comment">    /**</span>
00371 <span class="comment">     * Saves a diagram as gif in the directory specified by _outputDir.</span>
00372 <span class="comment">     * Returns a String with the path to the saved gif file.</span>
00373 <span class="comment">     * TODO: Solve same Bug as in trySaveAllDiagrams() and implement </span>
00374 <span class="comment">     * better control for overwrite of old files. </span>
00375 <span class="comment">     */</span>
<a name="l00376"></a><a class="code" href="classorg_1_1argoprint_1_1uml__interface_1_1UMLInterface.html#a11">00376</a>     <span class="keyword">public</span> String <a class="code" href="classorg_1_1argoprint_1_1uml__interface_1_1UMLInterface.html#a11">saveDiagram</a>(UMLDiagram diagram) 
00377     <span class="keywordflow">throws</span> Exception{
00378     <span class="comment">//Todo: fix bug mentioned i trySaveAllDiagrams</span>
00379 
00380     <span class="keywordflow">if</span>( diagram instanceof Diagram ) {
00381         String defaultName = ((Diagram) diagram).getName();
00382         _log.info(<span class="stringliteral">"active diagram"</span> + 
00383               _project.getActiveDiagram().getName());
00384         _project.setActiveDiagram((ArgoDiagram) diagram);
00385         _log.info(<span class="stringliteral">"active diagram"</span> + 
00386               _project.getActiveDiagram().getName());
00387         
00388         defaultName = Util.stripJunk(defaultName);
00389         
00390         _log.info(<span class="stringliteral">"diagram name "</span> + defaultName);
00391         
00392         <span class="keywordflow">try</span> {
00393         File defFile = 
00394             <span class="keyword">new</span> File(<a class="code" href="classorg_1_1argoprint_1_1uml__interface_1_1UMLInterface.html#q0">_outputDir</a> + 
00395                  defaultName + <span class="stringliteral">"."</span>
00396                  + FileFilters.GIFFilter._suffix);
00397         
00398         _log.info(<span class="stringliteral">"diagram filename "</span> + defaultName + <span class="stringliteral">"."</span>
00399               + FileFilters.GIFFilter._suffix);
00400         
00401         <span class="keywordflow">if</span> (defFile != null) {
00402             String path = defFile.getParent();
00403             _log.info(<span class="stringliteral">"diagram path "</span> + path); 
00404             
00405             String name = defFile.getName();
00406             _log.info(<span class="stringliteral">"diagram name "</span> + name);
00407             
00408             String extension = SuffixFilter.getExtension(defFile);
00409             _log.info(<span class="stringliteral">"diagram ext "</span> + extension);
00410             
00411             CmdSaveGraphics cmd = null;
00412             
00413             cmd = <span class="keyword">new</span> CmdSaveGIF();
00414                 
00415 
00416             <span class="keywordflow">if</span> ( !path.endsWith( <a class="code" href="classorg_1_1argoprint_1_1uml__interface_1_1UMLInterface.html#s0">separator</a> ) ) {
00417             path += <a class="code" href="classorg_1_1argoprint_1_1uml__interface_1_1UMLInterface.html#s0">separator</a>;
00418             }
00419             
00420             _projectBrowser.showStatus( <span class="stringliteral">"Writing "</span> + path + name + <span class="stringliteral">"..."</span> );
00421             _log.info( <span class="stringliteral">"Writing "</span> + path + name + <span class="stringliteral">"..."</span> );    
00422 
00423             <span class="keywordflow">if</span> ( defFile.exists() ) {
00424             String t = <span class="stringliteral">"Overwrite "</span> + path + name;
00425             <span class="keywordtype">int</span> response =
00426                 JOptionPane.showConfirmDialog(_projectBrowser,
00427                               t, t,
00428                               JOptionPane.YES_NO_OPTION);
00429             <span class="keywordflow">if</span> (response == JOptionPane.NO_OPTION){ 
00430                 <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(<span class="stringliteral">"Cannot overwrite file"</span>);
00431             }
00432             }
00433             
00434             FileOutputStream fo = <span class="keyword">new</span> FileOutputStream( defFile );
00435             cmd.setStream(fo);
00436             cmd.doIt();
00437             fo.close();
00438             _projectBrowser.showStatus( <span class="stringliteral">"Wrote "</span> + path + name );
00439             _log.info( <span class="stringliteral">"Wrote "</span> + path + name + <span class="stringliteral">"..."</span> );
00440             <span class="comment">//return true;</span>
00441             <span class="keywordflow">return</span> <span class="keyword">new</span> String(path + name);
00442         }
00443         
00444         }
00445         <span class="keywordflow">catch</span> ( FileNotFoundException ignore )
00446         {
00447             <span class="keywordflow">throw</span> ignore;
00448         }
00449         <span class="keywordflow">catch</span> ( IOException ignore )
00450         {
00451             <span class="keywordflow">throw</span> ignore;
00452         }
00453     }
00454     
00455     <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(<span class="stringliteral">"Not a valid diagram"</span>);
00456     }
00457 <span class="comment"></span>
00458 <span class="comment">    /**</span>
00459 <span class="comment">     * Tests saving of diagrams as gif-files.</span>
00460 <span class="comment">     * TODO: Solve bug that causes only open diagram to</span>
00461 <span class="comment">     * be saved. </span>
00462 <span class="comment">     */</span>
<a name="l00463"></a><a class="code" href="classorg_1_1argoprint_1_1uml__interface_1_1UMLInterface.html#a12">00463</a>     <span class="keyword">public</span> <span class="keywordtype">boolean</span> <a class="code" href="classorg_1_1argoprint_1_1uml__interface_1_1UMLInterface.html#a12">trySaveAllDiagrams</a>( <span class="keywordtype">boolean</span> overwrite ) {
00464     
00465     _log.info(<span class="stringliteral">"trySaveAllDiagrams started"</span>);
00466 
00467     Vector diagramVector =
00468         _project.getDiagrams();
00469     
00470     <span class="keywordtype">int</span> diagramVectorSize = diagramVector.size();
00471         
00472     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; diagramVectorSize; i++){
00473         Object target = diagramVector.elementAt(i); 
00474         
00475         <span class="keywordflow">if</span>( target instanceof Diagram ) {
00476         String defaultName = ((Diagram) target).getName();
00477         _log.info(<span class="stringliteral">"active diagram"</span> + 
00478               _project.getActiveDiagram().getName());
00479         _project.setActiveDiagram((ArgoDiagram) target);
00480         _log.info(<span class="stringliteral">"active diagram"</span> + 
00481             _project.getActiveDiagram().getName());
00482 
00483         defaultName = Util.stripJunk(defaultName);
00484 
00485         _log.info(<span class="stringliteral">"diagram name "</span> + defaultName);
00486 
00487         <span class="keywordflow">try</span> {
00488             File defFile = 
00489             <span class="keyword">new</span> File(<span class="stringliteral">"/home/pum3/danielsson/"</span> + 
00490                  defaultName + <span class="stringliteral">"."</span>
00491                  + FileFilters.GIFFilter._suffix);
00492 
00493             _log.info(<span class="stringliteral">"diagram filename "</span> + defaultName + <span class="stringliteral">"."</span>
00494                  + FileFilters.GIFFilter._suffix);
00495 
00496             <span class="keywordflow">if</span> (defFile != null) {
00497             String path = defFile.getParent();
00498             _log.info(<span class="stringliteral">"diagram path "</span> + path); 
00499 
00500             String name = defFile.getName();
00501             _log.info(<span class="stringliteral">"diagram name "</span> + name);
00502 
00503             String extension = SuffixFilter.getExtension(defFile);
00504             _log.info(<span class="stringliteral">"diagram ext "</span> + extension);
00505      
00506             CmdSaveGraphics cmd = null;
00507                 
00508             cmd = <span class="keyword">new</span> CmdSaveGIF();
00509                 
00510 
00511             <span class="keywordflow">if</span> ( !path.endsWith( <a class="code" href="classorg_1_1argoprint_1_1uml__interface_1_1UMLInterface.html#s0">separator</a> ) ) {
00512                 path += <a class="code" href="classorg_1_1argoprint_1_1uml__interface_1_1UMLInterface.html#s0">separator</a>;
00513             }
00514             
00515             _projectBrowser.showStatus( <span class="stringliteral">"Writing "</span> + path + name + <span class="stringliteral">"..."</span> );
00516             _log.info( <span class="stringliteral">"Writing "</span> + path + name + <span class="stringliteral">"..."</span> );    
00517 
00518             <span class="keywordflow">if</span> ( defFile.exists() &amp;&amp; !overwrite ) {
00519                 String t = <span class="stringliteral">"Overwrite "</span> + path + name;
00520                 <span class="keywordtype">int</span> response =
00521                 JOptionPane.showConfirmDialog(_projectBrowser,
00522                                   t, t,
00523                                   JOptionPane.YES_NO_OPTION);
00524                 <span class="keywordflow">if</span> (response == JOptionPane.NO_OPTION) <span class="keywordflow">return</span> <span class="keyword">false</span>;
00525             }
00526                 
00527             FileOutputStream fo = <span class="keyword">new</span> FileOutputStream( defFile );
00528             cmd.setStream(fo);
00529             cmd.doIt();
00530             fo.close();
00531             _projectBrowser.showStatus( <span class="stringliteral">"Wrote "</span> + path + name );
00532             _log.info( <span class="stringliteral">"Wrote "</span> + path + name + <span class="stringliteral">"..."</span> );
00533             <span class="comment">//return true;</span>
00534             }
00535             
00536         }
00537         <span class="keywordflow">catch</span> ( FileNotFoundException ignore )
00538             {
00539             <span class="comment">//cat.error("got a FileNotFoundException", ignore);</span>
00540             }
00541         <span class="keywordflow">catch</span> ( IOException ignore )
00542             {
00543             <span class="comment">//cat.error("got an IOException", ignore);</span>
00544             }
00545         
00546         <span class="comment">//diagramVector.removeElementAt(0);</span>
00547         }
00548 
00549         <span class="comment">//return false;</span>
00550     }
00551     <span class="keywordflow">return</span> <span class="keyword">true</span>;
00552     }<span class="comment">/*end of method save all diags */</span>
00553    
00554 } <span class="comment">/* end class UMLInteface */</span>
00555 
00556 
00557 
00558 
00559 
00560 
00561 
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Tue Dec 2 22:50:56 2003 for ArgoPrint by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.4 </small></address>
</body>
</html>
